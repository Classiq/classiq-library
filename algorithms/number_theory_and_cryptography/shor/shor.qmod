qfunc period_finding(n: int, a: int, x: qnum, phase_var: qnum) {
  x ^= 1;
  qpe_flexible(lambda(p) {
    modular_multiply_constant_inplace(n, a ** p, x);
  }, phase_var);
}

qfunc main(output phase_var: qnum<10, UNSIGNED, 10>) {
  x: qnum;
  allocate(5, x);
  allocate(phase_var);
  period_finding(21, 11, x, phase_var);
  drop(x);
}
