qperm oracle(const est_reg: qbit[]) {
  Z(est_reg[est_reg.len - 1]);
}

qfunc load_distribution(asset: qnum) {
  inplace_prepare_state([
    2.6787259421e-05,
    3.5390662236e-05,
    4.6351644275e-05,
    6.019464101e-05,
    7.7528875103e-05,
    9.9054807756e-05,
    0.000125569557208,
    0.000157970931952,
    0.000197259718539,
    0.000244539869482,
    0.000301016256974,
    0.0003679896938,
    0.00044684897396,
    0.000539059751514,
    0.00064615015569,
    0.00076969313121,
    0.000911285592379,
    0.00107252458447,
    0.001254980752495,
    0.001460169521811,
    0.001689520492804,
    0.001944345639492,
    0.002225806975332,
    0.002534884405734,
    0.002872344523152,
    0.003238711115134,
    0.003634238147414,
    0.004058885952684,
    0.004512301301784,
    0.004993801959126,
    0.005502366230463,
    0.006036627901531,
    0.006594876844076,
    0.007175065435091,
    0.00777482079994,
    0.008391462754445,
    0.009022027189109,
    0.009663294514291,
    0.010311822671818,
    0.010963984119196,
    0.011616006109859,
    0.012264013528464,
    0.012904073495508,
    0.013532240930861,
    0.014144604261291,
    0.014737330471882,
    0.015306708734268,
    0.015849191894156,
    0.016361435164522,
    0.016840331446946,
    0.017283042789073,
    0.017687027578627,
    0.018050063171024,
    0.018370263745826,
    0.018646093284629,
    0.018876373657154,
    0.019060287891366,
    0.019197378785607,
    0.019287543094604,
    0.019331021585702,
    0.019328385316047,
    0.019280518525187,
    0.019188598570622,
    0.019054073356258,
    0.018878636715922,
    0.018664202216661,
    0.018412875840259,
    0.018126927987047,
    0.017808765224843,
    0.017460902178609,
    0.017085933924358,
    0.016686509215048,
    0.016265304827719,
    0.015825001280955,
    0.015368260130931,
    0.014897703013511,
    0.014415892560094,
    0.013925315276636,
    0.013428366439136,
    0.012927337025377,
    0.012424402672087,
    0.011921614619259,
    0.011420892579339,
    0.010924019448263,
    0.01043263775812,
    0.009948247757278,
    0.009472206993095,
    0.009005731264694,
    0.008549896808379,
    0.008105643576054,
    0.007673779467034,
    0.007254985375734,
    0.006849820921645,
    0.006458730733348,
    0.006082051164994,
    0.005720017331224,
    0.00537277035491,
    0.005040364730935,
    0.004722775718412,
    0.00441990668307,
    0.004131596320824,
    0.003857625702666,
    0.003597725089854,
    0.003351580476833,
    0.003118839827334,
    0.002899118976553,
    0.002692007179255,
    0.002497072289948,
    0.002313865567007,
    0.002141926097748,
    0.001980784845922,
    0.001829968327077,
    0.00168900192054,
    0.001557412829636,
    0.001434732704065,
    0.001320499940209,
    0.00121426167657,
    0.001115575502588,
    0.001024010899749,
    0.000939150434283,
    0.000860590720846,
    0.000787943176437,
    0.000720834583461,
    0.000658907480343,
    0.000601820397439,
    0.000549247955213,
    0.000500880840836,
    0.000456425678405
  ], 0, asset);
}

qperm payoff(const asset: qnum, ind: qbit) {
  ind ^= asset < 32;
}

qfunc state_preparation(asset: qbit[], ind: qbit) {
  load_distribution(asset);
  payoff(asset, ind);
}

qfunc space_transform(est_reg: qbit[]) {
  state_preparation(est_reg[0:est_reg.len - 1], est_reg[est_reg.len - 1]);
}

qfunc main(k: int, output indicator: qbit) {
  est_reg: qbit[];
  problem_vars: qbit[7];
  allocate(problem_vars);
  allocate(indicator);
  within {
    {problem_vars, indicator} -> est_reg;
  } apply {
    amplitude_amplification(k, oracle, space_transform, est_reg);
  }
  drop(problem_vars);
}
